#!/bin/bash
source /etc/nas-management.conf

if mountpoint -q "$MOUNT_POINT" 2>/dev/null; then
    umount "$MOUNT_POINT"
    echo "Unmounted $MOUNT_POINT"
else
    echo "Not mounted"
fi

if [ -b /dev/mapper/"$MAPPER_NAME" ]; then
    cryptsetup close "$MAPPER_NAME"
    echo "LUKS closed - safe to unplug"
else
    echo "LUKS already closed"
fi